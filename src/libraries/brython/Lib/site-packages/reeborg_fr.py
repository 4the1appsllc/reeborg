from browser import window

from reeborg_common import *

__id = "fr"

_usage_ = '''
<h2 id="%s">Commandes de base</h2>

    <p>Veuillez prendre note: en Javascript, <code>true</code> et <code>false</code> sont écrits
    en lettre minuscules; en Python, <code>True</code> et <code>False</code> débutent avec une
    lettre majuscule. Dans les explications ci-dessous, j'utilise la notation Python.</p>

<p> En plus de comprendre le Javascript ou le Python, Reeborg et tous les autres robots
connaissent les instructions suivantes:
</p>
<ul>
  <li><code>au_but()</code>: la condition est <code>True</code> si Reeborg a atteint son but.</li>
  <li><code>construit_un_mur()</code>: ajoute un mur tout juste devant la position de Reeborg</li>
  <li><code>termine</code>: indique qu'un programme doit se terminer avec cette instruction. </li>
  <li><code>rien_devant()</code>: <code>True</code> s'il n'y a pas d'obstacle bloquant la voie de Reeborg.</li>
  <li><code>mur_devant()</code>: <code>True</code> s'il y a un mur bloquant la voie de Reeborg.</li>
  <li><code>face_au_nord()</code>: <code>True</code> si Reeborg fait face au nord (vers le haut de l'écran).
      </li>
  <li><code>avance()</code></li>
  <li><code>depose()</code> ou <code>depose("objet")</code> où "objet" est l'un de
    <code>"jeton"</code>,
    <code>"triangle"</code>, <code>"carré"</code>, <code>"étoile"</code>, etc. :
    Reeborg dépose l'objet
    en question là où il se trouve.</li>
    <li><code>objet_ici()</code>: retourne une liste vide, équivalente logique à "false"
    s'il n'y a aucun objet à cet endroit, autrement on
    retourne une liste contenant le nom des objets trouvés à cet endroit. On peut également
    spécifier le nom d'un objet comme argument de cette fonction pour vérifier si au moins
    un objet du genre s'y trouve.</li>
    <li><code>transporte()</code>: indique si Reeborg transporte des objets ou non. L'utilisation
    est tout à fait semblable à celle de <code>objet_ici()</code>.
    </li>
  <li><code>rien_a_droite()</code>: <code>True</code> s'il n'y a pas d'obstacle immédiatement à la droite de
      Reeborg.</li>
  <li><code>mur_a_droite()</code>: <code>True</code> s'il y a un mur immédiatement à la droite de
      Reeborg.</li>
  <li><code>prend()</code> ou <code>prend("objet")</code> où "objet" est l'un de
     <code>"jeton"</code>, <code>"triangle"</code>, <code>"carré"</code>,
     <code>"étoile"</code>, etc.</li>
  <li><code>tourne_a_gauche()</code></li>
</ul>


<p>Pour créer des robots, on peut utiliser <code>RobotUsage()</code> prédédé de <code>new</code>
si on utilise Javascript.
</p>
<p>De plus, les commandes suivantes sont généralement disponibles sans être liées
  à un robot en particulier. </p>
<ul>
    <li><code>from biblio import *</code>: pour <b>Python</b>, iinclut le code qui se trouve sous
        l'onglet bibliothèque</li>
  <li><code>examine(objet Javascript)</code></li>
  <li><code>pause()</code>; peut être invoqué avec un argument en millisecondes
  indiquant la durée
  de la pause dans quel cas le programme continue sans avoir à cliquer sur un bouton. </li>
    <li><code>son(<code>True</code>)</code>: ajoute des effets sonores. Ces effets sonores peuvent être
        arrêtés en utilant "false" comme argument ou omettant l'argument comme ceci:
        <code>son()</code>.
        Les effets sonores sont arrêtés par défaut ou si le délai entre les actions est
        inférieur à 250ms.  </li>
  <li><code>pense(nombre)</code>: spécifie le montant de temps (en millisecondes) entre chaque
      action d'un robot. </li>
  <li><code>ecrit(chaîne)</code>: écrit une chaîne de caractère dans le journal de Reeborg,
      par exemple <code>ecrit("Bonjour !")</code>,
    mais <b>seulement</b> si le monde est visible - autrement utiliser <code>print</code>. </li>
  <li><code>Monde(chaîne)</code>: sélectionne un monde donné. </li>
  <li><code>print(chaîne)</code>: seulement valide avec Python; semblable à <code>write</code>.
  </li>
</ul>
''' % ("basic-commands-" + __id)
RUR = window.RUR
RUR.ui.add_help(_usage_, __id, "Français",
                "Au lieu de biblio, jeton, étoile, triangle et carré, utilisez : ")


# RUR._x_ defined in commands.js
au_but = RUR._at_goal_
construit_un_mur = RUR._build_wall_
rien_devant = RUR._front_is_clear_
mur_devant = RUR._wall_in_front_
face_au_nord = RUR._is_facing_north_
avance = RUR._move_
depose = RUR._put_
rien_a_droite = RUR._right_is_clear_
mur_a_droite = RUR._wall_on_right_
prend = RUR._take_
tourne_a_gauche = RUR._turn_left_
nombre_de_commandes = RUR._set_max_steps_
nombre_de_robots = RUR._set_max_nb_robots_
# defined in rur_utils.js
examine = RUR.inspect
voir_source = RUR.view_source
# defined in control.js
ecrit = RUR.control._write
termine = RUR.control.done
son = RUR.control.sound
pense = RUR.control.think
pause = RUR.control.pause
Monde = RUR.file_io.load_world_from_program
narration = RUR.control.narration
clear_print = RUR.control.clear_print
couleur_de_trace = RUR._set_trace_color_
style_de_trace = RUR.vis_robot.set_trace_style
MenuPersonalisé = RUR.custom_menu.make

disparait = RUR.world.__remove_default_robot
pas_de_surlignement = RUR.ui.user_no_highlight


def objet_ici(arg=None):
    if arg is not None:
        ans = RUR._object_here_(arg)
    else:
        ans = RUR._object_here_()
    return list(ans)  # convert from Javascript list-like object to proper Python list


def transporte(arg=None):
    if arg is not None:
        ans = RUR._carries_object_(arg)
    else:
        ans = RUR._carries_object_()
    return list(ans)

# The following is the only language specific function which can only be used in monde.html,
# not when imported from world.html
try:
    confirmer = RUR.confirmer
except AttributeError:
    pass


class RobotUsage(object):
    def __init__(self, x=1, y=1, orientation='e', jetons=None):
        if jetons is None:
            robot = RUR.robot.create_robot(x, y, orientation)
        else:
            robot = RUR.robot.create_robot(x, y, orientation, jetons)
        self.body = robot
        RUR.world.add_robot(self.body)

    def avance(self):
        RUR.control.move(self.body)

    def au_but(self):
        return RUR.control.at_goal(self.body)

    def construit_un_mur(self):
        RUR.control.build_wall(self.body)

    def rien_devant(self, no_frame=False):
        return RUR.control.front_is_clear(self.body, no_frame)

    def mur_devant(self):
        return RUR.control.wall_in_front(self.body)

    def face_au_nord(self):
        return RUR.control.is_facing_north(self.body)

    def depose(self, arg=False):
        RUR.control.put(self.body, arg)

    def rien_a_droite(self):
        return RUR.control.right_is_clear(self.body)

    def mur_a_droite(self):
        return RUR.control.wall_on_right(self.body)

    def objet_ici(self, obj=None):
        if obj is not None:
            return list(RUR.control.object_here(self.body, obj))
        else:
            return list(RUR.control.object_here(self.body))

    def transporte(self, obj=None):
        if obj is not None:
            return list(RUR.control.carries_object(self.body, obj))
        else:
            return list(RUR.control.carries_object(self.body))

    def prend(self, arg=False):
        RUR.control.take(self.body, arg)

    def tourne_a_gauche(self, no_frame=False):
        RUR.control.turn_left(self.body, no_frame)

    def modèle(self, model):
        RUR.control.set_model(self.body, model)

    def couleur_de_trace(self, color):
        RUR.control.set_trace_color(self.body, color)


class Cartographe():

    @property
    def monde(self):
        '''retourne un dict qui contient l'information au
           sujet du monde.
        '''
        import json
        return json.loads(window.JSON.stringify(RUR.current_world))

    def imprime(self):
        '''imprime une copie formattée de la carte'''
        # First, use the builtin JSON Javascript function as it can
        # show a nicely formatted representation of the world;
        # this should have been implemented in the Brython json module
        # but is currently missing.
        world_str = window.JSON.stringify(RUR.current_world, None, 2)
        print(world_str)
